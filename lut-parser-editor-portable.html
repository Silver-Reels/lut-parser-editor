<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUT Parser & Editor Tool</title>
<!--by Mikhail Leon-->
</head>
<body>
    
</body>
<script>
 var e=document.body;async function M(e){let t=document.createElement("img");t.src=e,t.crossOrigin="anonymous",t.onload=()=>{l.src=t.src}}e.style.margin="0",e.style.backgroundColor="#080808",e.style.fontFamily="sans-serif";let y=document.createElement("div"),l=(y.style.position="absolute",y.style.left="12vw",y.style.top="7vw",y.style.width="54vw",y.style.height="36vw",y.style.overflow="hidden",y.style.clipPath="polygon(0 0, 100% 0, 100% 100%, 0% 100%)",y.style.border="1px solid #FFFFFF",y.style.userSelect="none",document.createElement("img")),D=(l.style.width="54vw",l.style.height="36vw",l.style.position="fixed",document.createElement("canvas")),c=D.getContext("2d");D.style.position="fixed";var t=document.createElement("form");t.style.width="15vw";let n=document.createElement("input");n.type="text",n.placeholder="Reference image path (local or URL)...",n.style.position="absolute",n.style.top="1vw",n.style.right="12.5vw",n.style.width="15vw";var o=document.createElement("button");o.style.position="absolute",o.style.top="1vw",o.style.right="1vw",o.style.border="0",o.style.borderRadius="2px",o.style.fontSize="1vw",o.innerText="Load Reference Image",t.onsubmit=e=>{e.preventDefault(),M(n.value);let t=!0;for(let e=0;e<"http".length;e++)if(n.value[e].toLowerCase()!="http"[e]){t=!1;break}t?M(n.value):l.src=n.value,W.style.backgroundColor="#FFFFFF"};let W=document.createElement("button");W.style.position="absolute",W.style.top="3vw",W.style.right="15.5vw",W.style.backgroundColor="#808080",W.style.border="0",W.style.borderRadius="2px",W.innerText="Clear Reference Image",W.onmousedown=()=>{l.src="",n.value="",W.style.backgroundColor="#808080"},e.appendChild(W);var i=document.createElement("p");i.innerText="Opacity",i.style.position="absolute",i.style.top="1.5vw",i.style.right="35vw",i.style.color="#FFFFFF";let X=document.createElement("input"),Y=(X.style.position="absolute",X.style.top="1vw",X.style.right="34vw",X.style.width="5vw",X.type="range",X.min=0,X.max=100,X.value=100,X.oninput=()=>{l.style.opacity=X.value+"%"},e.appendChild(i),e.appendChild(X),0),P=0,U=1,B=1,z=1;var i=document.createElement("p"),s=document.createElement("p");i.innerText="Move X",s.innerText="Move Y",i.style.position="absolute",s.style.position="absolute",i.style.top="1.5vw",s.style.top="1.5vw",i.style.right="57vw",s.style.right="44vw",i.style.color="#FFFFFF",s.style.color="#FFFFFF";let a=document.createElement("input"),r=(a.style.position="absolute",a.style.top="1vw",a.style.right="52vw",a.style.width="12vw",a.type="range",a.min=-80,a.max=80,a.step=.025,a.value=Y,document.createElement("input"));r.style.position="absolute",r.style.top="1vw",r.style.right="39.5vw",r.style.width="12vw",r.type="range",r.min=-80,r.max=80,r.step=.025,r.value=P,a.oninput=()=>{Y=+a.value,l.style.transform=`translate(${Y}%, ${-P}%) scale(${U}) scaleX(${B}) scaleY(${z})`},r.oninput=()=>{P=+r.value,l.style.transform=`translate(${Y}%, ${-P}%) scale(${U}) scaleX(${B}) scaleY(${z})`},e.appendChild(i),e.appendChild(s),e.appendChild(a),e.appendChild(r);i=document.createElement("p");i.innerText="Scale",i.style.position="absolute",i.style.top="1.5vw",i.style.right="67vw",i.style.color="#FFFFFF";let G=document.createElement("input");G.style.position="absolute",G.style.top="1vw",G.style.right="64.5vw",G.style.width="7vw",G.type="range",G.value=U,G.min=1,G.max=3,G.step=.025,G.oninput=()=>{U=+G.value,l.style.transform=`translate(${Y}%, ${-P}%) scale(${U}) scaleX(${B}) scaleY(${z})`},e.appendChild(i),e.appendChild(G);s=document.createElement("p");s.innerText="Stretch X",s.style.position="absolute",s.style.top="1.5vw",s.style.right="81vw",s.style.color="#FFFFFF";let V=document.createElement("input");V.style.position="absolute",V.style.top="1vw",V.style.right="79.5vw",V.style.width="7vw",V.type="range",V.min=1,V.max=2,V.step=.025,V.value=B,V.oninput=()=>{B=+V.value,l.style.transform=`translate(${Y}%, ${-P}%) scale(${U}) scaleX(${B}) scaleY(${z})`},e.appendChild(s),e.appendChild(V);i=document.createElement("p");i.innerText="Stretch Y",i.style.position="absolute",i.style.top="1.5vw",i.style.right="73.5vw",i.style.color="#FFFFFF";let q=document.createElement("input");q.style.position="absolute",q.style.top="1vw",q.style.right="72vw",q.style.width="7vw",q.type="range",q.min=1,q.max=2,q.step=.025,q.value=z,q.oninput=()=>{z=+q.value,l.style.transform=`translate(${Y}%, ${-P}%) scale(${U}) scaleX(${B}) scaleY(${z})`},e.appendChild(i),e.appendChild(q),e.backgroundColor="#808080";s=document.createElement("button");s.style.position="absolute",s.style.top="5vw",s.style.right="1vw",s.style.border="0",s.style.borderRadius="2px",s.style.fontSize="1.1vw",s.innerText="Load LUT...";let K,d=[],p=(s.onmousedown=async()=>{var e=await window.showOpenFilePicker({types:[{accept:{"*/*":[".lut"]}}],multiple:!1,excludeAcceptAllOption:!0}).then(e=>e[0].getFile()).then(e=>e.arrayBuffer());for(K=function(e){if("ArrayBuffer"!=e.constructor.name)throw Error("Input for parseLUT must be an ArrayBuffer.");let t=new Uint8Array(e),l="",n=!0,o=!1,i=!1,s=!1,a=!1,r=!1,d=!1,p="",y="",c="",u={},h=1;for(let e=0;e<t.length;e++){if(l=String.fromCharCode(t[e]),n){if(9===t[e]||32===t[e]||10===t[e]||13===t[e]&&10===t[e+1]){13===t[e]&&e++,10===t[e]&&h++;continue}if(59===t[e]){for(e++;10!=t[e];){if(13===t[e]);else{if(e===t.length)break;c+=String.fromCharCode(t[e])}e++}u[h]={data:[p,y],comment:c},p="",y="",c="",h++;continue}if(47<t[e]&&t[e]<58){n=!1,o=!0,p+=l;continue}throw Error(`BAD SYNTAX ON LINE ${h}: FOUND CHAR ${l} WHILE EXPECTING NUMBER, SPACE, TAB, NEWLINE OR COMMENT (expectingKey)`)}if(o)if(47<t[e]&&t[e]<58||46===t[e]){if(46===t[e]){if(e===t.length-1||t[e+1]<48||57<t[e+1])throw Error(`BAD SYNTAX ON LINE ${h}: FOUND A DOT WITHOUT FOLLOW-UP DIGIT (readingKey)`);if(!0===d)throw Error(`BAD SYNTAX ON LINE ${h}: FOUND DOT MORE THAN ONCE (readingKey)`);d=!0}p+=l}else{if(9!==t[e]&&32!==t[e]&&124!==t[e])throw Error(`BAD SYNTAX ON LINE ${h}: FOUND CHAR ${l} WHILE EXPECTING NUMBER/SPACE/TAB (readingKey)`);o=!1,d=!1,124===t[e]?a=!0:i=!0}else if(i){if(9!==t[e]&&32!==t[e]){if(124!==t[e])throw Error(`BAD SYNTAX ON LINE ${h}: FOUND CHAR ${l} WHILE AWAITING "|", SPACE OR TAB (expectingSeparator)`);i=!1,a=!0}}else{if(a){if(9===t[e]||32===t[e])continue;if(47<t[e]&&t[e]<58){a=!1,r=!0,y+=l;continue}throw Error(`BAD SYNTAX ON LINE ${h}: FOUND CHAR ${l} WHILE EXPECTING NUMBER, SPACE OR TAB(readingValue)`)}if(r){if(47<t[e]&&t[e]<58||46===t[e]){if(46===t[e]){if(e===t.length-1||t[e+1]<48||57<t[e+1])throw Error(`BAD SYNTAX ON LINE ${h}: FOUND A DOT WITHOUT FOLLOW-UP DIGIT (readingValue)`);if(!0===d)throw Error(`BAD SYNTAX ON LINE ${h}: FOUND DOT MORE THAN ONCE (readingValue)`);d=!0}y+=l,e+1===t.length&&(u[h]={data:[p,y],comment:c});continue}if(9===t[e]||32===t[e]){r=!1,d=!1,s=!0,e+1===t.length&&(u[h]={data:[p,y],comment:c});continue}if(59===t[e]){for(e++,r=!1;10!=t[e];){if(13===t[e]);else{if(e===t.length)break;c+=String.fromCharCode(t[e])}e++}u[h]={data:[p,y],comment:c},p="",y="",c="",h++,n=!0;continue}if(10===t[e]||13===t[e]&&10===t[e+1]){13===t[e]&&e++,r=!1,u[h]={data:[p,y],comment:c},p="",y="",c="",h++,n=!0;continue}throw Error(`BAD SYNTAX ON LINE ${h}: FOUND CHAR ${l} WHILE EXPECTING NUMBER, TAB, SPACE, NEWLINE OR COMMENT (readingValue)`)}if(s&&9!==t[e]&&32!=t[e]){if(59!==t[e])throw Error(`BAD SYNTAX ON LINE ${h}: FOUND CHAR ${l} WHILE EXPECTING NEWLINE (expectingNewLine)`);for(e++;10!=t[e];){if(13===t[e]);else{if(e===t.length)break;c+=String.fromCharCode(t[e])}e++}s=!1,u[h]={data:[p,y],comment:c},p="",y="",c="",h++,n=!0}}}return u}(e);1<p.childElementCount;)p.children[1].remove();d=Object.entries(K);for(let e=0;e<d.length;e++){var t=d[e][1].data[0];t.length&&(d[e][1].data[0]=""+(+t+1))}d=d.sort((e,t)=>+e[1].data[0]-+t[1].data[0]);for(let e=0;e<d.length;e++){var l=d[e][1].data[0];l.length&&(d[e][1].data[0]=""+(+l-1))}for(let t=0;t<d.length-1;t++)if(+d[t][1].data[0]==+d[t+1][1].data[0]&&d[t][1].data[0].length){for(let e=t+1;e<d.length;e++)d[e-1]=d[e];--d.length,t--}for(let e=0;e<d.length;e++)d[e][1].data[0].length&&Z(+d[e][1].data[0],+d[e][1].data[1]);{let t=0,l=0,n=0;for(let e=0;e<d.length;e++)(n=d[e][1].data[1]).length&&(+n>l&&(l=+n),+n<t)&&(t=+n);m=+p.children[1].children[0].value-g,v=t-g,f=+p.children[p.childElementCount-1].children[0].value+g,w=l+g,F.value=m+g,b.value=v+g,E.value=f-g,C.value=w-g}se(),Te(),he()},document.createElement("div"));p.style.position="absolute",p.style.display="flex",p.style.top="7vw",p.style.right="1vw",p.style.width="15vw",p.style.height="35vw",p.style.backgroundColor="#000000",p.style.overflowY="scroll",p.style.overflowX="hidden",p.style.flexDirection="column",p.style.rowGap="0.66vw",p.style.padding="0.66vw",p.style.borderRadius="3px",p.style.scrollbarColor="#000000";i=document.createElement("div");i.style.display="grid",i.style.gridTemplateColumns="4vw 4vw 3vw",i.style.columnGap="0.33vw",i.style.marginBottom="1vw";let _=document.createElement("input"),j=(_.value=0,_.type="number",_.min=0,_.step=1,_.style.border="0",_.style.borderRadius="2px",document.createElement("input"));j.value=0,j.type="number",j.min=0,j.step=1,j.style.border="0",j.style.borderRadius="2px";var u=document.createElement("button");function h(){for(;1<p.childElementCount;)p.children[1].remove();for(let e=0;e<d.length;e++){var t=d[e][1].data[0];t.length&&(d[e][1].data[0]=""+(+t+1))}d=d.sort((e,t)=>+e[1].data[0]-+t[1].data[0]);for(let e=0;e<d.length;e++){var l=d[e][1].data[0];l.length&&(d[e][1].data[0]=""+(+l-1))}for(let t=0;t<d.length-1;t++)if(+d[t][1].data[0]==+d[t+1][1].data[0]&&d[t][1].data[0].length){for(let e=t+1;e<d.length;e++)d[e-1]=d[e];--d.length,t--}for(let e=0;e<d.length;e++)d[e][1].data[0].length&&Z(+d[e][1].data[0],+d[e][1].data[1]);se(),Te()}u.innerText="+",u.style.backgroundColor="#209020",u.style.cursor="pointer",u.style.border="0",u.style.width="2vw",u.style.borderRadius="2px",u.onmousedown=e=>{var l=e.srcElement.parentElement.firstChild.value,n=e.srcElement.parentElement.children[1].value;if(d.length)if(+l<+d[0][1].data[0]){d.unshift([""+d[0][0],{data:[""+ +_.value,""+ +j.value],comment:""}]);for(let e=1;e<d.length;e++)d[e][0]=""+(+d[e][0]+1);h()}else if(+l>+d[d.length-1][1].data[0])d.push([""+(+d[d.length-1][0]+1),{data:[""+ +_.value,""+ +j.value],comment:""}]),h();else for(let t=0;t<d.length;t++){var o=+d[t][1].data[0];if(o==+l)return d[t][1].data[1]=""+ +n,void h();if(null!=d[t+1]&&o<+l&&+l<+d[t+1][1].data[0]){d.push(d[d.length-1]);for(let e=d.length-1;e>t+1;e--)d[e]=d[e-1];for(let e=t+1;e<d.length;e++)d[e][0]=""+(+d[e][0]+1);return d[t+1]=[""+(+d[t+1][0]-1),{data:[""+ +_.value,""+ +j.value],comment:""}],void h()}}else d.push(["1",{data:[""+ +_.value,""+ +j.value],comment:""}]),h()},i.appendChild(_),i.appendChild(j),i.appendChild(u),p.appendChild(i);let J=`<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
  <defs>
    <style>
      .cls-1 {fill: none;}
      .cls-1, .cls-2 {stroke: #231f20;stroke-miterlimit: 10;}
      .cls-2{fill: #8fa6d6;}
    </style>
  </defs>
  <path class="cls-2" d="m76.34,5.96H22.92C11.82,5.96,2.82,14.96,2.82,26.07v21.97c0,10.49,8.04,19.1,18.3,20.01l-14.5,27.76,48.49-27.67h21.23c11.1,0,20.1-9,20.1-20.1v-21.97c0-11.1-9-20.1-20.1-20.1Z"/>
  <line class="cls-1" x1="17.7" y1="16.37" x2="81.19" y2="16.37"/>
  <line class="cls-1" x1="17.7" y1="26.24" x2="81.19" y2="26.24"/>
  <line class="cls-1" x1="17.7" y1="36.11" x2="81.19" y2="36.11"/>
  <line class="cls-1" x1="17.7" y1="45.98" x2="81.19" y2="45.98"/>
</svg>`;function Z(e,t){var l=document.createElement("div");l.style.display="grid",l.style.gridTemplateColumns="4vw 4vw 2vw 3vw",l.style.columnGap="0.33vw";let n=document.createElement("input"),o=(n.type="number",n.value=e,n.min=0,n.step=1,n.style.border="0",n.style.borderRadius="2px",document.createElement("input"));o.type="number",o.value=t,o.min=0,o.step=1,o.style.border="0",o.style.borderRadius="2px",n.setAttribute("x-old-value",e),o.setAttribute("x-old-value",t),n.onchange=t=>{var l=+t.srcElement.parentElement.children[0].attributes.getNamedItem("x-old-value").value;for(let e=0;e<d.length;e++)if(+d[e][1].data[0]==l){d[e][1].data[0]=n.value,t.srcElement.parentElement.children[0].setAttribute("x-old-value",n.value);break}h()},o.onchange=t=>{var l=+t.srcElement.parentElement.children[0].attributes.getNamedItem("x-old-value").value;for(let e=0;e<d.length;e++)if(+d[e][1].data[0]==l){d[e][1].data[1]=o.value,t.srcElement.parentElement.children[1].setAttribute("x-old-value",o.value);break}h()};e=document.createElement("svg"),e.style.height="1.5vw",e.style.cursor="pointer",e.innerHTML=J,e.onmousedown=e=>{var t=we=+e.srcElement.parentElement.parentElement.parentElement.firstChild.value;if(null!==t)for(let e=0;e<d.length;e++)if(d[e][1].data[0].length&&+d[e][1].data[0]===t){I.value=d[e][1].comment;break}ge.innerText=`Comment for point (${we}, ${+e.srcElement.parentElement.parentElement.parentElement.children[1].value} )`,fe=!0,R.style.opacity="1",R.style.pointerEvents="all",S.style.opacity="1",S.style.pointerEvents="all"},t=document.createElement("button");t.innerText="X",t.style.backgroundColor="#902020",t.style.cursor="pointer",t.style.border="0",t.style.width="2vw",t.style.borderRadius="2px",t.onmousedown=e=>{var l=+e.srcElement.parentElement.firstChild.value;for(let t=0;t<d.length;t++)if(d[t][1].data[0].length)if(+d[t][1].data[0]==l){for(let e=t;e<d.length-1;e++)d[e]=d[e+1],d[e][0]=""+(+d[e][0]-1);--d.length;break}h()},l.onmouseenter=e=>{var t=+e.srcElement.firstChild.value;for(let e=2;e<y.childElementCount;e++)if(t==+y.children[e].getAttribute("x-old-x"))return y.children[e].style.border="3px solid #FFFFFF",void(y.children[e].style.backgroundColor="#000000")},l.onmouseleave=()=>{for(let e=2;e<y.childElementCount;e++)y.children[e].style.border="0",y.children[e].style.backgroundColor=te},l.appendChild(n),l.appendChild(o),l.appendChild(e),l.appendChild(t),p.appendChild(l)}t.appendChild(o),t.appendChild(n),e.appendChild(t),y.appendChild(l),e.appendChild(y),D.width=y.clientWidth,D.height=y.clientHeight,y.appendChild(D),e.appendChild(s),e.appendChild(p);let m=0,v=0,f=100,w=100,g=0,F=document.createElement("input"),b=document.createElement("input"),E=document.createElement("input"),C=document.createElement("input"),x=document.createElement("input");F.type="number",b.type="number",E.type="number",C.type="number",x.type="number",F.value=m,b.value=v,E.value=f,C.value=w,x.value=g,F.style.border="0",b.style.border="0",E.style.border="0",C.style.border="0",x.style.border="0",F.style.borderRadius="2px",b.style.borderRadius="2px",E.style.borderRadius="2px",C.style.borderRadius="2px",x.style.borderRadius="2px",F.step=1,b.step=1,E.step=1,C.step=1,x.step=1,F.onchange=()=>{m=+F.value+g,se(),Te(),he()},b.onchange=()=>{v=+b.value+g,se(),Te(),he()},E.onchange=()=>{f=+E.value+g,se(),Te(),he()},C.onchange=()=>{w=+C.value+g,se(),Te(),he()},x.onchange=()=>{g=+x.value,m=+F.value-g,v=+b.value-g,f=+E.value+g,w=+C.value+g,se(),Te(),he()},F.style.position="absolute",b.style.position="absolute",E.style.position="absolute",C.style.position="absolute",x.style.position="absolute",F.style.left="3vw",b.style.left="3vw",E.style.left="6.5vw",C.style.left="6.5vw",x.style.left="6.5vw",F.style.top="18vw",b.style.top="20vw",E.style.top="18vw",C.style.top="20vw",x.style.top="23vw",F.style.width="3vw",b.style.width="3vw",E.style.width="3vw",C.style.width="3vw",x.style.width="3vw",F.style.height="1.5vw",b.style.height="1.5vw",E.style.height="1.5vw",C.style.height="1.5vw",x.style.height="1.5vw";u=document.createElement("p"),i=document.createElement("p"),o=document.createElement("p"),t=document.createElement("p"),s=document.createElement("p");u.style.position="absolute",i.style.position="absolute",o.style.position="absolute",t.style.position="absolute",s.style.position="absolute",u.style.lineHeight="0",i.style.lineHeight="0",o.style.lineHeight="0",t.style.lineHeight="0",s.style.lineHeight="0",u.style.fontSize="1vw",i.style.fontSize="1vw",o.style.fontSize="1vw",t.style.fontSize="1vw",s.style.fontSize="1vw",u.style.color="#FFFFFF",i.style.color="#FFFFFF",o.style.color="#FFFFFF",t.style.color="#FFFFFF",s.style.color="#FFFFFF",u.innerText="X",i.innerText="Y",o.innerText="min",t.innerText="max",s.innerText="margin",u.style.top="18vw",u.style.left="2vw",i.style.top="20vw",i.style.left="2vw",o.style.top="16vw",o.style.left="4vw",t.style.top="16vw",t.style.left="7vw",s.style.top="23vw",s.style.left="3vw",e.appendChild(u),e.appendChild(i),e.appendChild(o),e.appendChild(t),e.appendChild(s),e.appendChild(F),e.appendChild(b),e.appendChild(E),e.appendChild(C),e.appendChild(x);let T=2,Q="#FFFF00",ee=10,te="#FFFF00",le=document.createElement("input");le.type="range",le.min=.5,le.max=4,le.step=.1,le.value=T,le.oninput=()=>{T=+le.value,Te()},le.style.position="absolute",le.style.top="28vw",le.style.left="1vw",e.appendChild(le);u=document.createElement("p"),u.innerText="Line Width",u.style.position="absolute",u.style.top="26vw",u.style.left="3vw",u.style.color="#FFFFFF",e.appendChild(u),i=document.createElement("p");i.innerText="Point Size",i.style.position="absolute",i.style.top="29vw",i.style.left="3vw",i.style.color="#FFFFFF",e.appendChild(i);let ne=document.createElement("input"),oe=(ne.type="range",ne.min=2,ne.max=15,ne.step=1,ne.value=ee,ne.oninput=()=>{ee=+ne.value,se()},ne.style.position="absolute",ne.style.top="31vw",ne.style.left="1vw",e.appendChild(ne),document.createElement("input"));oe.type="color",oe.style.position="absolute",oe.style.top="41vw",oe.style.left="2vw",oe.style.width="2vw",oe.style.border="0",oe.style.borderRadius="2px",oe.value=Q,oe.oninput=()=>{Q=oe.value,te=oe.value,se(),Te()},e.appendChild(oe);o=document.createElement("p");o.innerText="Graph",o.style.color="#FFFFFF",o.style.position="absolute",o.style.top="38.5vw",o.style.left="1.6vw",e.appendChild(o);let ie=document.createElement("p");ie.style.position="absolute",ie.innerText="(x,y)",ie.style.top="6vw",ie.style.right="28vw",ie.style.color="#FFFFFF",ie.style.fontSize="1.2vw",ie.style.width="5vw",e.appendChild(ie);t=document.createElement("p"),t.style.position="absolute",t.innerText="Reference Image Controls:",t.style.top="0.2vw",t.style.left="3vw",t.style.lineHeight="1",t.style.color="#FFFFFF",t.style.width="12vw",t.style.pointerEvents="none",e.appendChild(t),s=document.createElement("p");function se(){for(;2<y.childElementCount;)y.children[y.childElementCount-1].remove();for(let e=0;e<d.length;e++){var t,l;d[e][1].data[0].length&&(t=d[e][1].data[0],l=d[e][1].data[1],y.appendChild(function(e,t){let l=document.createElement("div"),n=(l.style.width=ee+"px",l.style.height=ee+"px",l.style.backgroundColor=te,l.style.position="fixed",l.style.borderRadius="200px",l.setAttribute("x-old-x",e),l.setAttribute("x-old-y",t),(e-m)/(f-m)),o=(t-v)/(w-v),i=ee/2;return l.style.transform=`translateX(${y.clientWidth*n-i}px) translateY(${y.clientHeight-y.clientHeight*o-i}px)`,l.onmousedown=e=>{ae=+l.getAttribute("x-old-x")},l.onmouseenter=e=>{for(let e=1;e<p.childElementCount;e++)if(p.children[e].children[0].value===l.getAttribute("x-old-x")){p.children[e].style.backgroundColor="#DDDDDD";break}},l.onmouseleave=e=>{for(let e=1;e<p.childElementCount;e++)p.children[e].style.backgroundColor="#000000"},l}(t,l)))}}s.innerHTML=`DISCLAIMER: Use only in fullscreen browser window on desktop. Do not resize the window. Requires modern browser with JavaScript enabled. Assigning the same 'X' value to multiple points will overwrite them (whether by typing values or dragging/clicking points). Exercise caution with floating point operations. Only positive numbers are currently supported by parser & writer. Always double-check all data. Loading reference images from URL is only possible from sources that allow anonymous fetching. Use reference images that are preferably already cropped to min & max on both axes for accuracy. No user data of any kind is collected. MIT License applies. 'LUT Parser & Editor Tool' developed by Mikhail Leon for entertainment purposes only, 2024. Read more information on <a target="_blank" href="https://github.com/Silver-Reels/lut-parser-editor">Github</a>.`,s.style.position="absolute",s.style.color="#FFFFFF",s.style.bottom="0vw",s.style.left="0vw",s.style.padding="0 1vw",s.style.fontSize="0.7vw",e.appendChild(s);let ae=null;window.onmousemove=t=>{if(!fe&&(t.clientX>y.offsetLeft&&t.clientX<y.clientWidth+y.offsetLeft&&t.clientY>y.offsetTop&&t.clientY<y.clientHeight+y.offsetTop?ie.innerText=`(${((t.clientX-y.offsetLeft)/y.clientWidth*(f-m)+m).toFixed(0)},${((1-(t.clientY-y.offsetTop)/y.clientHeight)*(w-v)+v).toFixed(0)})`:ie.innerText="(x,y)",null!==ae))for(let e=0;e<d.length;e++){var l,n;if(+(+d[e][1].data[0]).toFixed(2)==+ae)return t.clientX<y.offsetLeft||t.clientX>y.clientWidth+y.offsetLeft||t.clientY<y.offsetTop||t.clientY>y.clientHeight+y.offsetTop?void 0:(l=""+((t.clientX-y.offsetLeft)/y.clientWidth*(f-m)+m).toFixed(2),n=""+((1-(t.clientY-y.offsetTop)/y.clientHeight)*(w-v)+v).toFixed(2),d[e][1].data[0]=l,d[e][1].data[1]=n,ae=+l,void h())}},window.onmouseup=e=>{if(!fe)if(null===ae){if(!(e.clientX<y.offsetLeft||e.clientX>y.clientWidth+y.offsetLeft||e.clientY<y.offsetTop||e.clientY>y.clientHeight+y.offsetTop)){var l=""+((e.clientX-y.offsetLeft)/y.clientWidth*(f-m)+m).toFixed(2),n=""+((1-(e.clientY-y.offsetTop)/y.clientHeight)*(w-v)+v).toFixed(2);if(d.length)if(+l<+d[0][1].data[0]){d.unshift([""+d[0][0],{data:[l,n],comment:""}]);for(let e=1;e<d.length;e++)d[e][0]=""+(+d[e][0]+1);h()}else if(+l>+d[d.length-1][1].data[0])d.push([""+(+d[d.length-1][0]+1),{data:[l,n],comment:""}]),h();else for(let t=0;t<d.length;t++){var o=d[t][1].data[0];if(o===l)return d[t][1].data[1]=n,void h();if(null!=d[t+1]&&+o<+l&&+l<+d[t+1][1].data[0]){d.push(d[d.length-1]);for(let e=d.length-1;e>t+1;e--)d[e]=d[e-1];for(let e=t+1;e<d.length;e++)d[e][0]=""+(+d[e][0]+1);return d[t+1]=[""+(+d[t+1][0]-1),{data:[l,n],comment:""}],void h()}}else d.push(["1",{data:[l,n],comment:""}]),h()}}else ae=null};let re=5,de=5,pe="#FFFFFF",ye=2,ce=10,ue,N=document.createElement("div");function he(){for(;0<N.childElementCount;)N.children[0].remove();for(let e=1;e<re;e++){var t=document.createElement("div"),t=(t.style.position="absolute",t.style.width=ye+"px",t.style.height=y.clientHeight+ce+"px",t.style.top=y.offsetTop-ce+"px",t.style.left=y.offsetLeft+y.clientWidth/re*e+"px",t.style.backgroundColor=""+pe,N.appendChild(t),document.createElement("p"));t.style.position="absolute",t.style.color="#FFFFFF",t.style.lineHeight="0",t.style.top=y.offsetTop-4*ce+"px",t.style.left=y.offsetLeft+y.clientWidth/re*e-2*ce+"px",t.innerText=""+((f-m)/re*e+m).toFixed(2),N.appendChild(t)}for(let e=1;e<de;e++){var l=document.createElement("div"),l=(l.style.position="absolute",l.style.height=ye+"px",l.style.width=y.clientWidth+ce+"px",l.style.left=y.offsetLeft+"px",l.style.top=y.offsetTop+y.clientHeight/de*e+"px",l.style.backgroundColor=""+pe,N.appendChild(l),document.createElement("p"));l.style.position="absolute",l.style.color="#FFFFFF",l.style.lineHeight="0",l.style.fontSize="1vw",l.style.left=y.offsetLeft+y.clientWidth+2*ce+"px",l.style.top=y.offsetTop+y.clientHeight-y.clientHeight/de*e-1.5*ce+"px",l.innerText=""+((w-v)/de*e+v).toFixed(2),N.appendChild(l)}}N.style.position="fixed",N.style.pointerEvents="none",N.style.userSelect="none",N.style.zIndex="2",N.style.width="100%",N.style.height="100%",N.style.opacity="5%",e.appendChild(N),he();let A=document.createElement("input"),L=(A.type="number",A.min=1,A.max=20,A.value=re,A.style.position="absolute",A.style.top="34.5vw",A.style.left="2vw",A.style.width="2vw",A.style.height="1.5vw",A.style.border="0",A.style.borderRadius="2px",document.createElement("input"));L.type="number",L.min=1,L.max=20,L.value=de,L.style.position="absolute",L.style.top="34.5vw",L.style.left="7vw",L.style.width="2vw",L.style.height="1.5vw",L.style.border="0",L.style.borderRadius="2px",A.onchange=()=>{re=+A.value,he()},L.onchange=()=>{de=+L.value,he()},e.appendChild(A),e.appendChild(L);u=document.createElement("p");u.innerText="Grid Divisions",u.style.position="absolute",u.style.color="#FFFFFF",u.style.top="32vw",u.style.left="2.5vw",e.appendChild(u);let me=document.createElement("input");me.type="range",me.min=0,me.max=100,me.step=1,me.value=5,me.style.position="absolute",me.style.top="38vw",me.style.left="3vw",me.style.width="5vw",me.oninput=()=>{ue=me.value,N.style.opacity=ue+"%"},e.appendChild(me);i=document.createElement("p");i.innerText="Grid Opacity",i.style.position="absolute",i.style.top="36vw",i.style.left="2.5vw",i.style.color="#FFFFFF",e.appendChild(i);let ve=document.createElement("input");ve.type="color",ve.style.position="absolute",ve.style.top="41vw",ve.style.left="7vw",ve.style.width="2vw",ve.style.border="0",ve.style.borderRadius="2px",ve.value=pe,ve.oninput=()=>{pe=ve.value,he()},e.appendChild(ve);o=document.createElement("p");o.innerText="Grid",o.style.color="#FFFFFF",o.style.position="absolute",o.style.top="38.5vw",o.style.left="7vw",e.appendChild(o);let fe=!1,we=null,R=document.createElement("div");R.style.zIndex=98,R.style.position="fixed",R.style.width="100%",R.style.height="100%",R.style.backdropFilter="blur(20px",R.style.transition="linear 0.2s",R.style.cursor="pointer",R.style.opacity="0",R.style.pointerEvents="none";t=document.createElement("p");t.innerText="Close",t.style.position="fixed",t.style.top="39%",t.style.color="#FFFFFF",t.style.left="85%",t.style.cursor="pointer";let S=document.createElement("div"),ge=(S.style.zIndex=99,S.style.position="fixed",S.style.left="10%",S.style.top="40%",S.style.width="80%",S.style.height="20%",S.style.backgroundColor="#080808",S.style.borderRadius="20px",S.style.opacity="0",S.style.pointerEvents="none",S.style.transition="linear 0.2s",document.createElement("p")),I=(ge.style.position="absolute",ge.style.top="50%",ge.style.left="40%",ge.style.color="#FFFFFF",ge.innerText="Comment for point (x,y)",document.createElement("input"));function Fe(){fe=!1,R.style.opacity="0",R.style.pointerEvents="none",S.style.opacity="0",S.style.pointerEvents="none"}I.style.position="relative",I.style.top="20%",I.style.left="5%",I.type="text",I.style.color="#000000",I.style.fontFamily="serif",I.style.lineHeight="1",I.style.width="90%",I.style.height="10%",I.oninput=()=>{if(null!==we)for(let e=0;e<d.length;e++)if(d[e][1].data[0].length&&+d[e][1].data[0]===we){d[e][1].comment=I.value;break}},R.onmousedown=()=>{Fe()},t.onmousedown=()=>{Fe()},S.appendChild(I),S.appendChild(ge),S.appendChild(t),e.append(S),e.append(R);let H=[],be=[];function Ee(){H.length=0;for(let e=be.length=0;e<d.length;e++)d[e][1].data[0].length&&(H.push(+d[e][1].data[0]),be.push(+d[e][1].data[1]))}function Ce(){Ee(),c.clearRect(0,0,D.width,D.height);var t,l,n=0,o=0,i=0,s=0;let a=0;var r;let d=0;var p;for(let e=0;e<H.length-1;e++)for([n,o,i,s]=function(e){var t=H,l=be,n=t[e-1]||t[e]-(t[e+1]-t[e]),o=t[e],i=t[e+1],t=t[e+2]||t[e+1],s=l[e-1]||l[e]-(l[e+1]-l[e]),a=l[e],r=l[e+1],l=l[e+2]||l[e+1],e=Math.sqrt(Math.pow(o-n,2)+Math.pow(a-s,2)),n=Math.sqrt(Math.pow(i-o,2)+Math.pow(r-a,2)),o=Math.sqrt(Math.pow(t-i,2)+Math.pow(l-r,2)),t=Math.pow(e,.5)+0,i=Math.pow(n,.5)+t,e=Math.pow(o,.5)+i;let d=(i-t)*((a-s)/+t-(r-s)/+i+(r-a)/(i-t)),p=(i-t)*((r-a)/(i-t)-(l-a)/(e-t)+(l-r)/(e-i));return isNaN(d)&&(d=0),isNaN(p)&&(p=0),[2*a-2*r+d+p,-3*a+3*r-2*d-p,d,a]}(e),a=Math.trunc(y.clientWidth*((H[e]-m)/(f-m))),r=Math.trunc(y.clientWidth*((H[e+1]-m)/(f-m))),a;a<r;a++)if(t=n*(l=(a/y.clientWidth*(f-m)+m-H[e])/(H[e+1]-H[e]))*l*l+o*l*l+i*l+s,d=y.clientHeight-Math.trunc(y.clientHeight*((t-v)/(w-v))),c.beginPath(),c.arc(a,d,T,0,2*Math.PI),c.fillStyle=Q,c.fill(),t=n*(l=((a+1)/y.clientWidth*(f-m)+m-H[e])/(H[e+1]-H[e]))*l*l+o*l*l+i*l+s,(p=y.clientHeight-Math.trunc(y.clientHeight*((t-v)/(w-v))))<d)for(;d-p>T;)d-=T,c.beginPath(),c.arc(a,d,T,0,2*Math.PI),c.fillStyle=Q,c.fill();else if(p>d)for(;p-d>T;)d+=T,c.beginPath(),c.arc(a,d,T,0,2*Math.PI),c.fillStyle=Q,c.fill()}let xe=1;function Te(){if(0===xe&&c.clearRect(0,0,D.width,D.height),1===xe&&Ce(),2===xe){Ee(),c.clearRect(0,0,D.width,D.height);let t=0;var n,o,i,s;let l=0;for(let e=0;e<H.length-1;e++)for(t=Math.trunc(y.clientWidth*((H[e]-m)/(f-m))),n=Math.trunc(y.clientWidth*((H[e+1]-m)/(f-m))),s=be[e+1]-be[e],t;t<n;t++)if(i=(t/y.clientWidth*(f-m)+m-H[e])/(H[e+1]-H[e]),o=be[e]+s*i,l=y.clientHeight-Math.trunc(y.clientHeight*((o-v)/(w-v))),c.beginPath(),c.arc(t,l,T,0,2*Math.PI),c.fillStyle=Q,c.fill(),i=((t+1)/y.clientWidth*(f-m)+m-H[e])/(H[e+1]-H[e]),o=be[e]+s*i,(nextY=y.clientHeight-Math.trunc(y.clientHeight*((o-v)/(w-v))))<l)for(;l-nextY>T;)l-=T,c.beginPath(),c.arc(t,l,T,0,2*Math.PI),c.fillStyle=Q,c.fill();else if(nextY>l)for(;nextY-l>T;)l+=T,c.beginPath(),c.arc(t,l,T,0,2*Math.PI),c.fillStyle=Q,c.fill()}}s=document.createElement("p");s.innerText="Visual Interpolation:";let k=document.createElement("button"),O=document.createElement("button"),$=document.createElement("button");function Ne(){let t=0,l=new Uint8Array(1073741824);var n="",o="",i="";let s=0;for(let e=0;e<d.length;e++){for(n=d[e][1].data[0],o=d[e][1].data[1],i=d[e][1].comment,s=0;s<n.length;)l[t]=n.charCodeAt(s),t++,s++;for(0!=s&&(s=0,l[t]=9,l[t+1]=124,l[t+2]=9,t+=3);s<o.length;)l[t]=o.charCodeAt(s),t++,s++;if(i.length)for(s=0,o.length&&(l[t]=9,t++),l[t]=59,t++;s<i.length;)l[t]=i.charCodeAt(s),t++,s++;l[t]=10,t++}!async function(e){var t=await window.showSaveFilePicker({suggestedName:"untitled.lut"}).then(e=>e.createWritable());await t.write(e),await t.close()}((l=l.slice(0,t)).buffer)}s.style.position="absolute",k.style.position="absolute",O.style.position="absolute",$.style.position="absolute",s.style.top="6.5vw",s.style.lineHeight="0",k.style.top="9vw",O.style.top="11vw",$.style.top="13vw",s.style.left="0.8vw",k.style.left="6.6vw",O.style.left="6.5vw",$.style.left="6.4vw",k.style.border="0",O.style.border="0",$.style.border="0",k.style.borderRadius="2px",O.style.borderRadius="2px",$.style.borderRadius="2px",s.style.fontSize="1.1vw",k.style.fontSize="1vw",O.style.fontSize="1vw",$.style.fontSize="1vw",k.innerText="None",O.innerText="Cubic",$.innerText="Linear",s.style.color="#FFFFFF",k.style.backgroundColor="#808080",O.style.backgroundColor="#FFFFFF",$.style.backgroundColor="#808080",k.onmousedown=()=>{xe=0,Te(),k.style.backgroundColor="#FFFFFF",O.style.backgroundColor="#808080",$.style.backgroundColor="#808080"},O.onmousedown=()=>{xe=1,Te(),k.style.backgroundColor="#808080",O.style.backgroundColor="#FFFFFF",$.style.backgroundColor="#808080"},$.onmousedown=()=>{xe=2,Te(),k.style.backgroundColor="#808080",O.style.backgroundColor="#808080",$.style.backgroundColor="#FFFFFF"},e.appendChild(s),e.appendChild(k),e.appendChild(O),e.appendChild($);u=document.createElement("button");u.style.position="absolute",u.style.top="5vw",u.style.right="10vw",u.style.border="0",u.style.borderRadius="2px",u.style.fontSize="1.1vw",u.innerText="Save as LUT",u.onmousedown=()=>{d.length&&Ne()},e.appendChild(u);
</script>
</html>